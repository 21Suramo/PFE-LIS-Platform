<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <title>Teams API Tester</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>

    <body>
        <h1>🛠️ Backend API Test – Team Management</h1>

        <div id="auth">
            <h2>🔐 Login</h2>
            <form id="loginForm">
                <label for="email">Email:</label>
                <input type="email" id="email" value="abdelouahid@test.com" required>

                <label for="password">Password:</label>
                <input type="password" id="password" value="qwerty1" required>

                <button type="submit">Login</button>
            </form>
            <p id="loginStatus"></p>
        </div>

        <div id="mainApp" style="display:none;">
            <h2>➕ Create Team</h2>
            <form id="createForm">
                <label for="name">Team Name:</label>
                <input type="text" id="name" required>

                <label for="description">Description:</label>
                <input type="text" id="description" required>

                <button type="submit">Create Team</button>
            </form>

            <h2>📋 All Teams</h2>
            <button onclick="getTeams()">Refresh List</button>
            <ul id="teamList"></ul>
        </div>

        <script>
            const API = {
                login: 'http://localhost:3000/api/auth/login',
                teams: 'http://localhost:3000/api/teams'
            };

            // LOGIN
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                const res = await fetch(API.login, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();

                if (data.token) {
                    localStorage.setItem('token', data.token);
                    document.getElementById('loginStatus').textContent = '✅ Logged in!';
                    document.getElementById('auth').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'block';
                    getTeams();
                } else {
                    document.getElementById('loginStatus').textContent = '❌ Login failed';
                }
            });

            // CREATE TEAM
            document.getElementById('createForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('name').value;
                const description = document.getElementById('description').value;
                const token = localStorage.getItem('token');

                const res = await fetch(API.teams, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ name, description }) // ✅ No leader sent
                });

                const data = await res.json();
                alert(data.message || 'Team created');
                getTeams();
            });

            // GET TEAMS
            async function getTeams() {
                const res = await fetch(API.teams);
                const teams = await res.json();

                const list = document.getElementById('teamList');
                list.innerHTML = '';
                teams.forEach(team => {
                    const li = document.createElement('li');
                    li.innerHTML = `<strong>${team.name}</strong> - ${team.description} 
          <em>(Leader: ${team.leaderName})</em>
          <button onclick="deleteTeam('${team._id}')">🗑️ Delete</button>`;
                    list.appendChild(li);
                });
            }

            // DELETE TEAM
            async function deleteTeam(id) {
                const token = localStorage.getItem('token');
                const res = await fetch(`${API.teams}/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await res.json();
                alert(data.message || 'Deleted');
                getTeams();
            }
        </script>
    </body>

</html>